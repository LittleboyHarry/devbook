"use strict";(self.webpackChunkgeekbook=self.webpackChunkgeekbook||[]).push([[308],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,k=d["".concat(s,".").concat(m)]||d[m]||c[m]||l;return n?a.createElement(k,i(i({ref:t},u),{},{components:n})):a.createElement(k,i({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8196:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return o},metadata:function(){return p},toc:function(){return u}});var a=n(7462),r=n(3366),l=(n(7294),n(3905)),i=["components"],o={title:"WSL2"},s=void 0,p={unversionedId:"win/dev/wsl",id:"win/dev/wsl",title:"WSL2",description:"\u5b89\u88c5",source:"@site/docs/win/22-dev/16-wsl.md",sourceDirName:"win/22-dev",slug:"/win/dev/wsl",permalink:"/geekbook/docs/win/dev/wsl",editUrl:"https://github.com/LittleboyHarry/geekbook/edit/main/docs/win/22-dev/16-wsl.md",tags:[],version:"current",sidebarPosition:16,frontMatter:{title:"WSL2"},sidebar:"win",previous:{title:"Scoop",permalink:"/geekbook/docs/win/dev/scoop"},next:{title:"Visual Studio",permalink:"/geekbook/docs/win/dev/visual-studio"}},u=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",children:[{value:"Win11 \u5bf9 WSLg \u56fe\u5f62\u5316\u529f\u80fd\u7684\u652f\u6301",id:"win11-\u5bf9-wslg-\u56fe\u5f62\u5316\u529f\u80fd\u7684\u652f\u6301",children:[],level:3},{value:"Debian",id:"debian",children:[],level:3},{value:"Ubuntu 20.04",id:"ubuntu-2004",children:[],level:3}],level:2},{value:"\u6280\u5de7",id:"\u6280\u5de7",children:[{value:"\u7aef\u53e3\u8f6c\u53d1",id:"\u7aef\u53e3\u8f6c\u53d1",children:[],level:3},{value:"\u7aef\u53e3\u4ee3\u7406",id:"\u7aef\u53e3\u4ee3\u7406",children:[],level:3},{value:"proxychains",id:"proxychains",children:[],level:3}],level:2},{value:"podman \u5bb9\u5668",id:"podman-\u5bb9\u5668",children:[],level:2},{value:"\u63a8\u8350\u9605\u8bfb",id:"\u63a8\u8350\u9605\u8bfb",children:[],level:2}],c={toc:u};function d(e){var t=e.components,n=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"\u5b89\u88c5"},"\u5b89\u88c5"),(0,l.kt)("p",null,"\u9996\u5148\uff0c\u7ba1\u7406\u5458\u8eab\u4efd\u8fd0\u884c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-powershell"},"dism /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart\ndism /online /enable-feature /featurename:VirtualMachinePlatform /all\n\n")),(0,l.kt)("p",null,"\u91cd\u542f\u5b8c\u6210\u540e\uff0c\u7ba1\u7406\u5458\u8eab\u4efd\u8fd0\u884c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"wsl --update\n")),(0,l.kt)("p",null,"\u5b89\u88c5\u5185\u6838\u540e\uff0c\u6311\u9009\u559c\u6b22\u7684\u53d1\u884c\u7248\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://aka.ms/wslstore"},"https://aka.ms/wslstore")),(0,l.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"\u914d\u7f6e\u5185\u6838\u81ea\u52a8\u66f4\u65b0")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"\u6253\u5f00\u66f4\u65b0\u8bbe\u7f6e ",(0,l.kt)("inlineCode",{parentName:"p"},"ms-settings:windowsupdate-options"),"\uff0c\n\u542f\u52a8\u201c\u63a5\u6536\u5176\u5b83 Microsoft \u4ea7\u54c1\u7684\u66f4\u65b0\u201d\u3002"))),(0,l.kt)("h3",{id:"win11-\u5bf9-wslg-\u56fe\u5f62\u5316\u529f\u80fd\u7684\u652f\u6301"},"Win11 \u5bf9 WSLg \u56fe\u5f62\u5316\u529f\u80fd\u7684\u652f\u6301"),(0,l.kt)("p",null,"\u4e0b\u8f7d\u5b89\u88c5\uff1a"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/microsoft/wslg/releases/latest/download/wsl_graphics_support_x64.msi"},"https://github.com/microsoft/wslg/releases/latest/download/wsl_graphics_support_x64.msi")),(0,l.kt)("p",null,"\u6027\u80fd\u6d4b\u8bd5\u5de5\u5177 ",(0,l.kt)("a",{parentName:"p",href:"https://command-not-found.com/glxgears"},(0,l.kt)("inlineCode",{parentName:"a"},"glxgears"))),(0,l.kt)("p",null,"\u9644\uff1a\u5173\u4e8e WSL2 \u7cfb\u7edf\u9700\u6c42\u548c\u5176\u5b83\u5b89\u88c5\u7ec6\u8282\u7684\u5b98\u65b9\u8bf4\u660e\n",(0,l.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/zh-cn/windows/wsl/install-manual#step-2---check-requirements-for-running-wsl-2"},"https://docs.microsoft.com/zh-cn/windows/wsl/install-manual#step-2---check-requirements-for-running-wsl-2")),(0,l.kt)("h3",{id:"debian"},"Debian"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"winget install 9MSVKQC78PK6\n")),(0,l.kt)("p",null,"\u542f\u52a8 Debian\uff0c\u521d\u59cb\u5316\u7528\u6237\u540d\u5bc6\u7801\u3002"),(0,l.kt)("p",null,"\u4f7f\u7528",(0,l.kt)("a",{parentName:"p",href:"https://mirrors.tuna.tsinghua.edu.cn/help/debian/"},"\u6e05\u534e\u955c\u50cf\u6e90")," testing \u7248\u672c\u5e76\u66f4\u65b0\u7cfb\u7edf"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"cd /etc/apt/\nsudo mv sources.list sources.list.initial\ncat <<EOF | sudo tee sources.list\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye main contrib non-free\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-updates main contrib non-free\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-backports main contrib non-free\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian-security bullseye-security main contrib non-free\nEOF\ncd -\n\nsudo apt update\nsudo apt dist-upgrade -y\n")),(0,l.kt)("p",null,"\u63a8\u8350\u5fc5\u88c5\u5305 ",(0,l.kt)("inlineCode",{parentName:"p"},"sudo apt install"),":"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"zsh")," \u8bbe\u7f6e\u9ed8\u8ba4\uff1a ",(0,l.kt)("inlineCode",{parentName:"li"},"chsh -s /bin/zsh")," \u53c2\u89c1",(0,l.kt)("a",{href:"/docs/dev/zsh",target:"_blank"},"\u914d\u7f6e")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"tree")," \u6587\u4ef6\u6811\u6253\u5370"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"unzip")," \u89e3\u538b"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"man-db")," man \u624b\u518c"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"git")," ",(0,l.kt)("inlineCode",{parentName:"li"},"curl")," ",(0,l.kt)("inlineCode",{parentName:"li"},"wget")," ",(0,l.kt)("inlineCode",{parentName:"li"},"python3")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"lsof")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"virt-manager"),": \u865a\u62df\u5316\u5e73\u53f0")),(0,l.kt)("p",null,"\u66f4\u591a\u63a8\u8350\u547d\u4ee4\u53c2\u8003 \u201c\u5f00\u53d1\u201d -> \u201c\u547d\u4ee4\u884c\u201d \u7ae0\u8282"),(0,l.kt)("h3",{id:"ubuntu-2004"},"Ubuntu 20.04"),(0,l.kt)("p",null,"\u540c\u7406"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"ms-windows-store://pdp/?productid=9N6SVWS3RX71&mode=mini\n")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/"},"\u6e05\u534e\u955c\u50cf\u6e90")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"cd /etc/apt/\nsudo mv sources.list sources.list.initial\ncat <<EOF | sudo tee sources.list\ndeb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse\ndeb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse\ndeb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse\ndeb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverseEOF\nEOF\ncd -\n\nsudo apt update\nsudo apt dist-upgrade\n")),(0,l.kt)("h2",{id:"\u6280\u5de7"},"\u6280\u5de7"),(0,l.kt)("h3",{id:"\u7aef\u53e3\u8f6c\u53d1"},"\u7aef\u53e3\u8f6c\u53d1"),(0,l.kt)("p",null,"\u5b89\u88c5 ",(0,l.kt)("inlineCode",{parentName:"p"},"socat")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo apt install -y socat\n")),(0,l.kt)("p",null,"\u5199\u5165 ",(0,l.kt)("inlineCode",{parentName:"p"},".bashrc")," \u6216 ",(0,l.kt)("inlineCode",{parentName:"p"},".zshrc")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"forwardport(){\n    local ports=(...) # \u7aef\u53e3\u8f6c\u53d1\n    local host=`cat /etc/resolv.conf | grep nameserver | cut -d ' ' -f 2`\n    for port in ${ports[@]}; do\n        socat TCP4-LISTEN:$port,fork TCP4:$host:$port & disown\n    done\n}\n")),(0,l.kt)("p",null,"\u8fd9\u6837\u6bcf\u6b21\u6253\u5f00 WSL \u65f6\uff0c\uff08\u6216\u5199\u5165 ",(0,l.kt)("inlineCode",{parentName:"p"},".zshrc")," \u81ea\u52a8\u6267\u884c\uff09\n\u6267\u884c\u4e00\u4e0b ",(0,l.kt)("inlineCode",{parentName:"p"},"forwardport")," \u5373\u53ef\u8f6c\u53d1\u865a\u62df\u673a\u5185\u7684\u6307\u5b9a\u7aef\u53e3\u5230\u5bbf\u4e3b\u673a ",(0,l.kt)("inlineCode",{parentName:"p"},"127.0.0.1")," \u4e0a"),(0,l.kt)("h3",{id:"\u7aef\u53e3\u4ee3\u7406"},"\u7aef\u53e3\u4ee3\u7406"),(0,l.kt)("p",null,"\u786e\u4fdd\u7aef\u53e3\u76d1\u542c ",(0,l.kt)("inlineCode",{parentName:"p"},"0.0.0.0")),(0,l.kt)("p",null,"\u4e3a\u89e3\u9664\u9632\u706b\u5899\u4fdd\u62a4\uff0c\u5148\u4ee5\u7ba1\u7406\u5458\u8eab\u4efd PowerShell \u8fd0\u884c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-powershell"},'# \u5173\u95ed\u5148\u524d\u7684\u89c4\u5219\uff1a\nDisable-NetFirewallRule -DisplayName "<\u8fdb\u7a0b\u540d>.exe"\n\nNew-NetFirewallRule -DisplayName "WSL" -Direction Inbound  -InterfaceAlias "vEthernet (WSL)"  -Action Allow\n')),(0,l.kt)("p",null,"\u8bbe\u7f6e\u4ee3\u7406\u76d1\u542c ",(0,l.kt)("inlineCode",{parentName:"p"},"0.0.0.0"),"\uff0c\u7981\u7528\u9632\u706b\u5899\u76f8\u5173\u89c4\u5219"),(0,l.kt)("p",null,"\u5728\u7aef\u53e3\u8f6c\u53d1\u7684\u57fa\u7840\u4e0a\uff0c\u914d\u7f6e ",(0,l.kt)("a",{href:"/docs/dev/cli/network",target:"_blank"},"proxychains"),"\u3002"),(0,l.kt)("h3",{id:"proxychains"},"proxychains"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"sudo sed -i -e \"\\$asocks5 $(cat /etc/resolv.conf |grep -oP '(?<=nameserver\\ ).*') <\u672c\u5730\u7aef\u53e3>\" -e '/^socks/d' /etc/proxychains4.conf\n")),(0,l.kt)("h2",{id:"podman-\u5bb9\u5668"},"podman \u5bb9\u5668"),(0,l.kt)("p",null,"\u53ef\u4e0d\u4f9d\u8d56 systemd \u7684\u5bb9\u5668\u5316\u6280\u672f"),(0,l.kt)("p",null,"\u66f4\u591a\u7248\u672c\u7684 podman\uff1a"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://software.opensuse.org/download/package?package=podman&project=devel%3Akubic%3Alibcontainers%3Astable"},"https://software.opensuse.org/download/package?package=podman&project=devel%3Akubic%3Alibcontainers%3Astable")),(0,l.kt)("p",null,"Q: \u51fa\u9519"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"exit status 2: iptables v1.8.7 (nf_tables): Couldn't load match `comment':No such file or directory")),(0,l.kt)("p",null,"A: ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/microsoft/WSL/issues/7948#issuecomment-1043467915"},"\u89e3\u51b3\u65b9\u6cd5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"sudo update-alternatives --set iptables /usr/sbin/iptables-legacy\nsudo update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy\n")),(0,l.kt)("h2",{id:"\u63a8\u8350\u9605\u8bfb"},"\u63a8\u8350\u9605\u8bfb"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://dowww.spencerwoo.com/"},"https://dowww.spencerwoo.com/")))}d.isMDXComponent=!0}}]);